generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Users {
  id                    Int              @id @default(autoincrement())
  email                 String
  title_th              String
  name_th               String
  position_id           String
  position              String
  hcode                 String
  hcode9                String
  hname_th              String
  district              String
  province              String
  zone                  String
  user_type             User_type        @default(Unit_service)
  role                  Role             @default(user)
  enabled               Boolean          @default(false)
  cratedAt              DateTime         @default(now())
  updateAt              DateTime         @updatedAt
  categories            Category[]
  chatMessages          ChatMessage[]
  chatReads             ChatRead[]
  chatRoomMembers       ChatRoomMember[]
  choices               Choice[]
  evaluates             Evaluate[]
  evaluateAnswers       EvaluateAnswer[]
  evidences             Evidence_all[]
  log_events            LogEvent[]
  receivedNotifications Notification[]   @relation("Receiver")
  sentNotifications     Notification[]   @relation("Sender")
  questions             Question[]
  sub_questions         Sub_quest[]
  topics                Topic[]
  hospitals             Hospitals        @relation(fields: [hcode9], references: [hcode9])

  @@index([hcode9], map: "Users_hcode9_fkey")
}

model Topic {
  id              Int              @id @default(autoincrement())
  topic_name      String           @db.Text
  user_id         Int
  status          Boolean          @default(false)
  cratedAt        DateTime         @default(now())
  updateAt        DateTime         @updatedAt
  categorys       Category[]
  chatRoom        ChatRoom[]
  choices         Choice[]
  evaluates       Evaluate[]
  evaluateAnswers EvaluateAnswer[]
  questions       Question[]
  sub_questions   Sub_quest[]
  users           Users            @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "Topic_user_id_fkey")
}

model Category {
  id                Int               @id @default(autoincrement())
  topic_id          Int
  category_name_th  String            @db.Text
  category_name_eng String            @db.Text
  fiscal_year       String
  user_id           Int
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  approveAnswers    Approve_answers[]
  topics            Topic             @relation(fields: [topic_id], references: [id], onDelete: Cascade)
  users             Users             @relation(fields: [user_id], references: [id])
  choices           Choice[]
  evaluates         Evaluate[]
  evaluateAnswers   EvaluateAnswer[]
  evidences         Evidence_all[]
  questions         Question[]
  sub_questions     Sub_quest[]

  @@index([topic_id], map: "Category_topic_id_fkey")
  @@index([user_id], map: "Category_user_id_fkey")
}

model Question {
  id              Int               @id @default(autoincrement())
  topic_id        Int
  category_id     Int
  question_name   String            @db.Text
  user_id         Int
  cratedAt        DateTime          @default(now())
  updateAt        DateTime          @updatedAt
  approveAnswers  Approve_answers[]
  choices         Choice[]
  evaluates       Evaluate[]
  evaluateAnswers EvaluateAnswer[]
  categories      Category          @relation(fields: [category_id], references: [id], onDelete: Cascade)
  topics          Topic             @relation(fields: [topic_id], references: [id], onDelete: Cascade)
  users           Users             @relation(fields: [user_id], references: [id])
  sub_questions   Sub_quest[]

  @@index([category_id], map: "Question_category_id_fkey")
  @@index([topic_id], map: "Question_topic_id_fkey")
  @@index([user_id], map: "Question_user_id_fkey")
}

model Sub_quest {
  id              Int               @id @default(autoincrement())
  topic_id        Int
  category_id     Int
  question_id     Int
  sub_quest_name  String            @db.Text
  is_required     Boolean           @default(false)
  question_type   QuestionType      @default(radio)
  user_id         Int
  cratedAt        DateTime          @default(now())
  updateAt        DateTime          @updatedAt
  approveAnswers  Approve_answers[]
  choices         Choice[]
  evaluateAnswers EvaluateAnswer[]
  categories      Category          @relation(fields: [category_id], references: [id])
  questions       Question          @relation(fields: [question_id], references: [id])
  topics          Topic             @relation(fields: [topic_id], references: [id])
  users           Users             @relation(fields: [user_id], references: [id])

  @@index([category_id], map: "Sub_quest_category_id_fkey")
  @@index([question_id], map: "Sub_quest_question_id_fkey")
  @@index([topic_id], map: "Sub_quest_topic_id_fkey")
  @@index([user_id], map: "Sub_quest_user_id_fkey")
}

model Choice {
  id              Int              @id @default(autoincrement())
  topic_id        Int
  category_id     Int
  question_id     Int
  sub_question_id Int?
  user_id         Int
  cratedAt        DateTime         @default(now())
  updateAt        DateTime         @updatedAt
  has_text        Boolean          @default(false)
  answers         Answer[]
  categories      Category         @relation(fields: [category_id], references: [id], onDelete: Cascade)
  questions       Question         @relation(fields: [question_id], references: [id], onDelete: Cascade)
  subQuestions    Sub_quest?       @relation(fields: [sub_question_id], references: [id])
  topics          Topic            @relation(fields: [topic_id], references: [id], onDelete: Cascade)
  users           Users            @relation(fields: [user_id], references: [id])
  evaluateAnswers EvaluateAnswer[]

  @@index([category_id], map: "Choice_category_id_fkey")
  @@index([question_id], map: "Choice_question_id_fkey")
  @@index([sub_question_id], map: "Choice_sub_question_id_fkey")
  @@index([topic_id], map: "Choice_topic_id_fkey")
  @@index([user_id], map: "Choice_user_id_fkey")
}

model Answer {
  id              Int              @id @default(autoincrement())
  choice_id       Int
  choice_text     String           @db.Text
  choice_value    Float
  choice_required Float
  choices         Choice           @relation(fields: [choice_id], references: [id])
  evaluateAnswers EvaluateAnswer[]

  @@index([choice_id], map: "Answer_choice_id_fkey")
}

model Evaluate {
  id              Int               @id @default(autoincrement())
  topic_id        Int
  category_id     Int
  question_id     Int
  status_check    Boolean           @default(false)
  is_draft        Boolean           @default(true)
  hospital_code   String
  hospital_name   String
  hospital_type   String
  file_name       String?
  ssj_approve     Boolean           @default(false)
  zone_approve    Boolean           @default(false)
  user_id         Int
  cratedAt        DateTime          @default(now())
  updateAt        DateTime          @updatedAt
  approveAnswers  Approve_answers[]
  categories      Category          @relation(fields: [category_id], references: [id])
  questions       Question          @relation(fields: [question_id], references: [id])
  topics          Topic             @relation(fields: [topic_id], references: [id])
  users           Users             @relation(fields: [user_id], references: [id])
  evaluateAnswers EvaluateAnswer[]

  @@index([category_id], map: "Evaluate_category_id_fkey")
  @@index([question_id], map: "Evaluate_question_id_fkey")
  @@index([topic_id], map: "Evaluate_topic_id_fkey")
  @@index([user_id], map: "Evaluate_user_id_fkey")
}

model EvaluateAnswer {
  id              Int        @id @default(autoincrement())
  evaluate_id     Int
  topic_id        Int
  category_id     Int
  question_id     Int
  sub_question_id Int?
  choice_id       Int
  answer_id       Int
  answer_text     String?    @db.Text
  answer_value    Float
  answer_required Float
  user_id         Int
  cratedAt        DateTime   @default(now())
  updateAt        DateTime   @updatedAt
  answers         Answer     @relation(fields: [answer_id], references: [id])
  categories      Category   @relation(fields: [category_id], references: [id])
  choices         Choice     @relation(fields: [choice_id], references: [id])
  evaluates       Evaluate   @relation(fields: [evaluate_id], references: [id], onDelete: Cascade)
  questions       Question   @relation(fields: [question_id], references: [id])
  subQuestions    Sub_quest? @relation(fields: [sub_question_id], references: [id])
  topics          Topic      @relation(fields: [topic_id], references: [id])
  users           Users      @relation(fields: [user_id], references: [id])

  @@index([evaluate_id])
  @@index([answer_id], map: "EvaluateAnswer_answer_id_fkey")
  @@index([category_id], map: "EvaluateAnswer_category_id_fkey")
  @@index([choice_id], map: "EvaluateAnswer_choice_id_fkey")
  @@index([question_id], map: "EvaluateAnswer_question_id_fkey")
  @@index([sub_question_id], map: "EvaluateAnswer_sub_question_id_fkey")
  @@index([topic_id], map: "EvaluateAnswer_topic_id_fkey")
  @@index([user_id], map: "EvaluateAnswer_user_id_fkey")
}

model Evidence_all {
  id          Int      @id @default(autoincrement())
  category_id Int
  file_ev     String
  hcode9      String
  user_id     Int
  cratedAt    DateTime @default(now())
  updateAt    DateTime @updatedAt
  categories  Category @relation(fields: [category_id], references: [id])
  users       Users    @relation(fields: [user_id], references: [id])

  @@index([category_id], map: "Evidence_all_category_id_fkey")
  @@index([user_id], map: "Evidence_all_user_id_fkey")
}

model Evidence_sub_id {
  id                 Int      @id @default(autoincrement())
  evaluate_id        Int
  sub_question_id    Int
  evaluate_answer_id Int
  hcode9             String
  ev_filename        String
  user_id            Int
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Approve_answers {
  id              Int       @id @default(autoincrement())
  evaluate_id     Int
  category_id     Int
  question_id     Int
  sub_question_id Int
  hospital_code   String
  prov_approve    Boolean   @default(false)
  zone_approve    Boolean   @default(false)
  user_id         Int
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  categories      Category  @relation(fields: [category_id], references: [id])
  evaluates       Evaluate  @relation(fields: [evaluate_id], references: [id])
  questions       Question  @relation(fields: [question_id], references: [id])
  sub_questions   Sub_quest @relation(fields: [sub_question_id], references: [id])

  @@index([category_id], map: "Approve_answers_category_id_fkey")
  @@index([evaluate_id], map: "Approve_answers_evaluate_id_fkey")
  @@index([question_id], map: "Approve_answers_question_id_fkey")
  @@index([sub_question_id], map: "Approve_answers_sub_question_id_fkey")
}

model ChatRoom {
  id            Int                @id @default(autoincrement())
  topic_id      Int
  room_type     ChatRoom_room_type
  hcode9        String             @db.VarChar(20)
  province_code String?            @db.VarChar(10)
  zone_code     String?            @db.VarChar(10)
  isActive      Boolean            @default(true)
  createdAt     DateTime           @default(now()) @db.DateTime(0)
  messages      ChatMessage[]
  topics        Topic              @relation(fields: [topic_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatroom_topic")
  members       ChatRoomMember[]

  @@unique([topic_id, room_type, hcode9, province_code, zone_code], map: "uq_chatroom_v2")
}

model ChatRoomMember {
  id       Int      @id @default(autoincrement())
  room_id  Int
  user_id  Int
  hcode9   String   @db.VarChar(20)
  joinedAt DateTime @default(now()) @db.DateTime(0)
  room     ChatRoom @relation(fields: [room_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatroommember_room")
  user     Users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatroommember_user")

  @@unique([room_id, user_id], map: "uq_room_user")
  @@index([user_id], map: "fk_chatroommember_user")
}

model ChatMessage {
  id        Int        @id @default(autoincrement())
  room_id   Int
  sender_id Int
  hcode9    String     @db.VarChar(20)
  content   String?    @db.Text
  image     String?    @db.VarChar(255)
  createdAt DateTime   @default(now()) @db.DateTime(0)
  isDeleted Boolean    @default(false)
  room      ChatRoom   @relation(fields: [room_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatmessage_room")
  sender    Users      @relation(fields: [sender_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatmessage_sender")
  reads     ChatRead[]

  @@index([room_id], map: "fk_chatmessage_room")
  @@index([sender_id], map: "fk_chatmessage_sender")
}

model ChatRead {
  id         Int         @id @default(autoincrement())
  message_id Int
  user_id    Int
  readAt     DateTime    @default(now()) @db.DateTime(0)
  message    ChatMessage @relation(fields: [message_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_chatread_message")
  user       Users       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_chatread_user")

  @@unique([message_id, user_id], map: "uq_message_user")
  @@index([user_id], map: "fk_chatread_user")
}

model Notification {
  id          Int      @id @default(autoincrement())
  sender_id   Int
  receiver_id Int
  message     String
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  type        String
  receiver    Users    @relation("Receiver", fields: [receiver_id], references: [id])
  sender      Users    @relation("Sender", fields: [sender_id], references: [id])

  @@index([receiver_id], map: "Notification_receiver_id_fkey")
  @@index([sender_id], map: "Notification_sender_id_fkey")
}

model Hospitals {
  id                Int     @id @default(autoincrement())
  hname_th          String
  hcode9            String  @unique
  hcode5            String
  dept_type         String
  medical_level     String?
  use_status        String
  sub_district_code String
  sub_district      String
  district_code     String
  district          String
  province_code     String
  province          String
  zone              String
  zone_name         String
  zipcode           String?
  users             Users[]
}

model LogEvent {
  id           Int          @id @default(autoincrement())
  event_rec_id Int
  table_name   Lookup_table @default(None)
  eventType    EventList    @default(none)
  description  String?      @db.Text
  detail       String?      @db.Text
  user_id      Int
  createdAt    DateTime     @default(now())
  users        Users        @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "LogEvent_user_id_fkey")
}

model Cyber_risk_level {
  id              Int      @id @default(autoincrement())
  hcode5          String?
  hcode9          String?
  province        String
  hname_th        String
  hosp_level      String
  cyber_level     String
  cyber_levelname String
  zone_name       String
  supplier        String
  usersId         Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum EventList {
  register
  signin
  signout
  create
  read
  update
  change_status
  request_edit
  cancel_edit
  delete
  upload
  approve
  unapprove
  cancel
  none
}

enum Lookup_table {
  Users
  Topic
  Category
  Question
  Evaluate
  Choice
  Survey
  Evidence_all
  Comment
  Reply_comment
  Notification
  Hospitals
  None
}

enum Role {
  admin
  user
}

enum User_type {
  Centre
  Zone
  Prov
  Unit_service
}

enum QuestionType {
  radio
  checkbox
}

enum ChatRoom_room_type {
  HOSPITAL_PROVINCE
  PROVINCE_REGION
}
